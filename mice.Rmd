---
title: "Mice protein expression"
output: html_document
---
Для работы нам понадобятся следующие пакеты
```
install.packages("readxl")
install.packages("dplyr")
install.packages("corrplot")
install.packages("ggplot2")
install.packages("multcomp")
install.packages("vegan")
```

```{r packages, include=FALSE}
library(readxl)
library(ggplot2)
library(dplyr)
library(corrplot)
library(vegan)
library(multcomp)

theme_set(theme_bw())
```

Создадим датасет
```{r}
mice_data <- read_excel("Data_Cortex_Nuclear.xls")
```
# Сделать описание датасета

## Сколько всего мышей было в эксперименте
38 конткрольных мышей и 34 мышей с синдромом дауна
## Какие группы вы можете можете выделить
Можно разделить на группы, которые были предложены авторами эксперимента:

c-CS-s: control mice, stimulated to learn, injected with saline (9 mice)
c-CS-m: control mice, stimulated to learn, injected with memantine (10 mice)
c-SC-s: control mice, not stimulated to learn, injected with saline (9 mice)
c-SC-m: control mice, not stimulated to learn, injected with memantine (10 mice)

t-CS-s: trisomy mice, stimulated to learn, injected with saline (7 mice)
t-CS-m: trisomy mice, stimulated to learn, injected with memantine (9 mice)
t-SC-s: trisomy mice, not stimulated to learn, injected with saline (9 mice)
t-SC-m: trisomy mice, not stimulated to learn, injected with memantine (9 mice) 

## Насколько эти группы сбалансированы
Группы не сбалансированы, т.к. количество мышей в группах отличается. Дисперсионный анализ лучше выполнять на группах с одинаковым количеством наблюдений.

## Какое количество полных наблюдений (речь про NA)
Всего NA: 1396
```{r}
sum(is.na(mice_data))
```
Наблюдений с NA: 528
```{r}
sum(!complete.cases(mice_data))
```
Наблюдений без NA: 1080 - 528 = 552

Посчитать в каких колонках больше всего NA:
```{r}
colSums(is.na(mice_data))
```
Следующие столбцы имеют особенно много NA, их лучше удалить для дальнейшей работы 
BAD_N:213, BCL2_N:285, pCFOS_N:75, H3AcK18_N:180, EGR1_N:210, H3MeK4_N:270

# Есть ли различия в уровне продукции BDNF_N в зависимости от класса вэксперименте 
```{r}
mice_BDNF <- mice_data[ ,c(4, 82)]
mice_BDNF$class = as.factor(mice_BDNF$class)

mod_BDNF_N <- lm(BDNF_N ~ class, data = mice_BDNF)
BDNF_N_anova <- anova(mod_BDNF_N)
BDNF_N_anova
```
Да, имеются статистически значимые отличия

##График остатков
```{r}
ggplot(mice_BDNF, aes(x = class, y = BDNF_N)) + geom_boxplot() + ggtitle("График остатков")
```

## Пост-хок тесты
```{r}
post_hoch <- glht(mod_BDNF_N, linfct = mcp(class = "Tukey"))
result<-summary(post_hoch)
result
```

Значимые различия (p < 0.05) были обнаружены между следующими парами:
```
c-SC-m - c-CS-m == 0 -0.0482717  0.0053980  -8.942  < 0.001 ***
c-SC-s - c-CS-m == 0 -0.0258249  0.0055459  -4.657  < 0.001 ***
t-CS-m - c-CS-m == 0 -0.0264852  0.0055459  -4.776  < 0.001 ***
t-CS-s - c-CS-m == 0 -0.0337570  0.0059483  -5.675  < 0.001 ***
t-SC-m - c-CS-m == 0 -0.0181541  0.0055459  -3.273  0.02409 *  
c-SC-m - c-CS-s == 0 -0.0513696  0.0055459  -9.263  < 0.001 ***
c-SC-s - c-CS-s == 0 -0.0289228  0.0056900  -5.083  < 0.001 ***
t-CS-m - c-CS-s == 0 -0.0295831  0.0056900  -5.199  < 0.001 ***
t-CS-s - c-CS-s == 0 -0.0368549  0.0060829  -6.059  < 0.001 ***
t-SC-m - c-CS-s == 0 -0.0212520  0.0056900  -3.735  0.00483 ** 
c-SC-s - c-SC-m == 0  0.0224468  0.0055459   4.047  0.00144 ** 
t-CS-m - c-SC-m == 0  0.0217865  0.0055459   3.928  0.00237 ** 
t-SC-m - c-SC-m == 0  0.0301176  0.0055459   5.431  < 0.001 ***
t-SC-s - c-SC-m == 0  0.0346406  0.0055790   6.209  < 0.001 ***
t-SC-s - t-CS-s == 0  0.0201260  0.0061130   3.292  0.02272 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05
```
# Анализ главных компонент
```{r}
mice_data_NA <- mice_data[complete.cases(mice_data), ]
mice_pca <- rda(mice_data_NA[,c(2:78)], scale = TRUE)
```

## Ординация

Биплот с симметричным шкалированием
```{r}
biplot(mice_pca)
```
Биплот расстояний
```{r}
biplot(mice_pca, scaling = "sites", display = "sites")
```
## Биплот корреляций
```{r}
biplot(mice_pca, scaling = "species", display = "species")
```

## Вклад компонент
```{r}
eigenvals(mice_pca)
bstick(mice_pca)
```
Визуализация для двух методов расчета
```{r}
screeplot(mice_pca, type = "lines", bstick = TRUE)
```


