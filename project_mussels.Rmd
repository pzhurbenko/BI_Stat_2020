---
title: "Project_mussels"
---
Нам понадобятся следующие пакеты, установите их, если они ещё не установлены:
```{r}
install.packages("ggplot2")
install.packages("plyr")
install.packages("ggpubr")
install.packages("na.tools")
install.packages("dplyr")
```

Подгружаем пакеты:
```{r}
library(plyr)
library(ggplot2)
library(ggpubr)
library(na.tools)
library(dplyr)
```

Функция для объединеия данных в одну таблицу:
```{r}
open_data <- function(pathway){
  setwd(pathway)
  mussels <<- ldply(list.files(), read.csv, header=TRUE)
    View(mussels)
}
```

Укажите путь к папке, где лежат данные:
```{r}
open_data("")
```

Заменим название колонки с данными о половой принадлежности, а также заменим обозначение пола на Male, Female и Uvenil. Значения больше 3 заменяем на NA.
```{r}
colnames(mussels)[which(names(mussels) == "Sex..1...male..2...female..3...uvenil.")] <- "Sex"

for (i in 1:4177) { 
    if (is.na(mussels$Sex[i])){
    next
  } else if (mussels$Sex[i] == 1){
    mussels$Sex[i] <- "Male"
  } else if (mussels$Sex[i] == 2) {
    mussels$Sex[i] <- "Female"
  } else if (mussels$Sex[i] == 3) {
    mussels$Sex[i] <- "Uvenil" 
  }  else if (mussels$Sex[i] == 4) {
    mussels$Sex[i] <- NA
  }  else if (mussels$Sex[i] == 5) {
    mussels$Sex[i] <- NA   
  } else {
    next
  }
}
```

Можно заметить, что в столбце Length имеются неточности в данных. Можно предположить, что при измерении использовались различные размерности единицы измерения. Для приведения данных у общему виду, я предлагаю следующий подход: все значения, которые превышают 1 разделить на 100.
```{r}
for (i in 1:4177) {
  if (is.na(mussels$Length[i])){
    next
  } else if (mussels$Length[i] > 1) {
    mussels$Length[i] <- mussels$Length[i] / 100
  } else {
    next
  }
}
```

Для выявления выбросов, построим boxplot для каждого столбца.
```{r, echo=FALSE}
gg_Rings <- ggplot(mussels) +
  aes(x = "", y = Rings) +
  geom_boxplot(fill = "white", width = 0.2) +
  theme_minimal()

gg_Length <- ggplot(mussels) +
  aes(x = "", y = Length) +
  geom_boxplot(fill = "white", width = 0.2) +
  theme_minimal()

gg_Diameter <- ggplot(mussels) +
  aes(x = "", y = Diameter) +
  geom_boxplot(fill = "white", width = 0.2) +
  theme_minimal()

gg_Height <- ggplot(mussels) +
  aes(x = "", y = Height) +
  geom_boxplot(fill = "white", width = 0.2) +
  theme_minimal()

gg_Whole_weight <- ggplot(mussels) +
  aes(x = "", y = Whole_weight) +
  geom_boxplot(fill = "white", width = 0.2) +
  theme_minimal()

gg_Shucked_weight <- ggplot(mussels) +
  aes(x = "", y = Shucked_weight) +
  geom_boxplot(fill = "white", width = 0.2) +
  theme_minimal()

gg_Viscera_weight <- ggplot(mussels) +
  aes(x = "", y = Viscera_weight) +
  geom_boxplot(fill = "white", width = 0.2) +
  theme_minimal()  

gg_Shell_weight <- ggplot(mussels) +
  aes(x = "", y = Shell_weight) +
  geom_boxplot(fill = "white", width = 0.2) +
  theme_minimal()
```

Отобразим все графики на одном рисунке:
```{r}
figure <- ggarrange(gg_Rings, gg_Length, gg_Diameter, gg_Height, gg_Whole_weight, 
                    gg_Shucked_weight, gg_Viscera_weight, gg_Shell_weight)
                    labels = c("Rings", "Length", "Diameter", "Height", "Whole_weight", "Shucked_weight", 
                               "Viscera_weight", "Shell_weight"),
                    ncol = 4, nrow = 2)
figure
```

Среднее значение и стандартное отклонение переменной Length для моллюсков разного пола:

```
Средние значения:
Мужской: 0.5771818
Женский: 0.5975556
Ювенальный: 0.4287761

Стандартное отклонение:
Мужской: 0.1267103
Женский: 0.1112485
Ювенальный: 0.1271847
```

```{r, echo=FALSE}
mussels %>% filter(Sex == "Male") %>% select(Length) %>% summarise(mean_length_male = mean(Length, na.rm=TRUE))
mussels %>% filter(Sex == "Female") %>% select(Length) %>% summarise(mean_length_female = mean(Length, na.rm=TRUE))
mussels %>% filter(Sex == "Uvenil") %>% select(Length) %>% summarise(mean_length_uvenil = mean(Length, na.rm=TRUE))

mussels %>% filter(Sex == "Male") %>% select(Length) %>% summarise(sd_length_male = sd(Length, na.rm=TRUE))
mussels %>% filter(Sex == "Female") %>% select(Length) %>% summarise(sd_length_female = sd(Length, na.rm=TRUE))
mussels %>% filter(Sex == "Uvenil") %>% select(Length) %>% summarise(sd_length_uvenil = sd(Length, na.rm=TRUE))
```
```
Значение переменной Height не превышает 0.165 у 71.25749% моллюсков
```
```{r, echo=FALSE}
less_165 <- mussels %>% filter(Height < 0.165) %>% select(Height) %>% count("Height")
more_165 <- mussels %>% filter(Height >= 0.165) %>% select(Height) %>% count("Height")
less_165[, 2] / (less_165[, 2] + more_165[, 2]) * 100
```
```
Значение переменной Length, которое больше, чем у 92% от всех наблюдений равняется 0.715
```
```{r, echo=FALSE}
mussels %>% select(Length) %>% summarize(Length_92pct = quantile(Length, probs=0.92, na.rm=TRUE))
mussels %>% select(Length) %>% summarize(Length_93pct = quantile(Length, probs=0.93, na.rm=TRUE))
#0.92 quantile равняется 0.71, а следующий за ним - 0.715
```
Значения переменной Length после её стандартизации:
```{r}
Lenght_z_scores  <- scale(mussels$Length)
```
```
Разброс значений диаметров моллюсков с числом колец 5 и 15 отображены на графике. 
Средние значения равняются 0.24716 и 0.4395 а, стандартные отклонения 0.1027841 и 0.08508131 соответственно.
```
```{r}
D_R_5 <- mussels %>% filter(Rings == 5) %>% select(Diameter)
D_R_15 <- mussels %>% filter(Rings == 15) %>% select(Diameter)
colnames(D_R_5)[which(names(D_R_5) == "Diameter")] <- "rings_5"
colnames(D_R_15)[which(names(D_R_15) == "Diameter")] <- "rings_15"
D_R <- merge(D_R_5, D_R_15)
boxplot(D_R)

mean(D_R$rings_15, na.rm=TRUE)
mean(D_R$rings_5, na.rm=TRUE)
```

